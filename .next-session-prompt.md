# Next Session Startup Prompt

Copy and paste this into a new Claude Code session to rebuild context efficiently:

---

I'm continuing work on **TabTaskTick Phase 2** for the TabMaster Pro Chrome extension. Please read `.claude-session-context.md` for full context.

## Quick Summary

**What's Complete**:
- ✅ Phase 1: IndexedDB foundation (db.js, storage-queries.js)
- ✅ Phase 2.1: Selection services (selectCollections.js, selectTasks.js)
- ✅ Phase 2.1.5: Playwright E2E testing infrastructure (smoke tests passing 3/3)

**Critical Issue Solved**:
- fake-indexeddb v6.2.3 has broken index queries in Jest (returns empty arrays)
- Migrated to Playwright for real Chrome IndexedDB testing
- E2E infrastructure complete and working

**Current Task**:
Write Playwright E2E tests to validate selection services work correctly with real IndexedDB index queries. This is CRITICAL because fake-indexeddb couldn't validate the core functionality.

**Files to Create**:
1. `/tests/e2e/selectCollections.spec.js` - Test collection filtering with indexes
2. `/tests/e2e/selectTasks.spec.js` - Test task filtering with compound indexes

**Pattern to Follow**:
- See `/tests/e2e/extension-loads.spec.js` for working examples
- Use `testPage` fixture (not `serviceWorkerPage` - no dynamic imports in service workers)
- See code examples in `.claude-session-context.md`

**After E2E Tests**:
Proceed to Phase 2.2 - CollectionService implementation (~300 lines, Jest unit tests)

**Commands**:
```bash
npm run test:e2e:headed     # Watch tests in browser
npm run test:e2e:ui         # Interactive mode
npm test                    # Run Jest unit tests
```

**Architecture Rules**:
1. Use `testPage` fixture for ES module imports
2. All IndexedDB index queries MUST use Playwright (not Jest)
3. Services call storage utilities (never direct IndexedDB)
4. Keep `workers: 1` in playwright.config.js

Should I proceed with writing the E2E tests for selectCollections and selectTasks?

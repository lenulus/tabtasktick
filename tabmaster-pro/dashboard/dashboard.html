<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TabTaskTick - Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
  <link rel="stylesheet" href="../components/snooze-modal.css">
  <link rel="stylesheet" href="../lib/preview.css">
  <link rel="stylesheet" href="../lib/conditions-builder.css">
  <link rel="stylesheet" href="../lib/rules-modal.css">
  <link rel="stylesheet" href="export-import.css">
  <script src="../lib/chart.min.js"></script>
</head>
<body>
  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="../icons/icon-48.png" alt="TabTaskTick">
        <h2>TabTaskTick</h2>
      </div>
      
      <nav class="sidebar-nav">
        <a href="#" class="nav-item active" data-view="overview">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
          </svg>
          Overview
        </a>
        
        <a href="#" class="nav-item" data-view="tabs">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M2 3h20v18H2zM8 3v18M16 3v18"></path>
          </svg>
          All Tabs
        </a>
        
        <a href="#" class="nav-item" data-view="groups">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="9" y1="3" x2="9" y2="21"></line>
            <line x1="15" y1="3" x2="15" y2="21"></line>
          </svg>
          Groups
        </a>
        
        <a href="#" class="nav-item" data-view="snoozed">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          Snoozed
        </a>
        
        <a href="#" class="nav-item" data-view="history">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
            <path d="M3 3v5h5"></path>
          </svg>
          History
        </a>

        <a href="#" class="nav-item" data-view="collections">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
          </svg>
          Collections
        </a>

        <a href="#" class="nav-item" data-view="tasks">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M9 11l3 3L22 4"></path>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
          </svg>
          Tasks
        </a>

        <a href="#" class="nav-item" data-view="rules">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M3 3h18v18H3zM12 8v8m-4-4h8"></path>
          </svg>
          Rules Engine
        </a>

        <a href="#" class="nav-item" data-view="export-import">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
            <polyline points="17 8 12 3 7 8"></polyline>
          </svg>
          Backup & Restore
        </a>
      </nav>
      
      <div class="sidebar-footer">
        <button class="btn-settings" id="openKeyboardShortcuts" title="Keyboard Shortcuts (Shift+?)">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
          Shortcuts
        </button>
        <button class="btn-settings" id="openSettings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M12 1v6m0 6v6m4.22-13.22l4.24 4.24M1.54 1.54l4.24 4.24M20.46 20.46l-4.24-4.24M1.54 20.46l4.24-4.24"></path>
          </svg>
          Settings
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Overview View -->
      <div class="view active" id="overview">
        <div class="view-header">
          <h1>Dashboard Overview</h1>
          <div class="header-actions">
            <button class="btn btn-primary" id="quickOrganize">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              Quick Organize
            </button>
            <button class="btn btn-secondary" id="refreshData">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
              </svg>
              Refresh
            </button>
          </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-container">
          <div class="stat-card stat-card-link" data-navigate="tabs" title="View all tabs">
            <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white">
                <path d="M2 3h20v18H2z"></path>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value" id="statTotalTabs">0</div>
              <div class="stat-label">Total Tabs</div>
              <div class="stat-change" id="statTabsChange">+0 today</div>
            </div>
          </div>

          <div class="stat-card stat-card-link" data-navigate="groups" title="View tab groups">
            <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="9" y1="3" x2="9" y2="21"></line>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value" id="statGroups">0</div>
              <div class="stat-label">Tab Groups</div>
              <div class="stat-change" id="statGroupsInfo">0 collapsed</div>
            </div>
          </div>

          <div class="stat-card stat-card-link" data-navigate="snoozed" title="View snoozed tabs">
            <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value" id="statSnoozed">0</div>
              <div class="stat-label">Snoozed</div>
              <div class="stat-change" id="statNextWake">Next in --</div>
            </div>
          </div>

          <div class="stat-card stat-card-link" data-navigate="duplicates" title="View duplicate tabs">
            <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white">
                <rect x="8" y="2" width="12" height="16" rx="2"></rect>
                <rect x="4" y="6" width="12" height="16" rx="2"></rect>
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-value" id="statDuplicates">0</div>
              <div class="stat-label">Duplicates</div>
              <div class="stat-change" id="statDuplicatesInfo">Click to clean up</div>
            </div>
          </div>
        </div>

        <!-- Charts -->
        <div class="charts-container">
          <div class="chart-card">
            <h3>Tab Activity (Last 7 Days)</h3>
            <div class="chart-wrapper">
              <canvas id="activityChart"></canvas>
            </div>
          </div>
          
          <div class="chart-card">
            <h3>Top Domains</h3>
            <div class="chart-wrapper">
              <canvas id="domainsChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="activity-section">
          <h3>Recent Activity</h3>
          <div class="activity-list" id="recentActivity">
            <!-- Activity items will be populated here -->
          </div>
        </div>
      </div>

      <!-- All Tabs View -->
      <div class="view" id="tabs">
        <div class="view-header">
          <h1>All Tabs <span id="tabCount" style="font-size: 18px; color: #666; font-weight: normal;"></span></h1>
          <div class="header-actions">
            <input type="text" class="search-input" id="searchTabs" placeholder="Search tabs...">
            <select class="filter-select" id="filterTabs">
              <option value="all">All Tabs</option>
              <option value="active">Active</option>
              <option value="suspended">Suspended</option>
              <option value="pinned">Pinned</option>
              <option value="audible">Playing Audio</option>
              <option value="muted">Muted</option>
              <option value="grouped">In Groups</option>
              <option value="ungrouped">Not Grouped</option>
              <option value="duplicates">Duplicates</option>
            </select>
            <select class="filter-select" id="windowFilter">
              <option value="all">All Windows</option>
              <!-- Window options will be dynamically added -->
            </select>
            <select class="filter-select" id="sortTabs">
              <option value="default">Default Order</option>
              <option value="window">Group by Window</option>
              <option value="recent">Most Recently Used</option>
              <option value="oldest">Least Recently Used</option>
              <option value="suspended">Suspended First</option>
              <option value="active">Active First</option>
              <option value="title">Title (A-Z)</option>
              <option value="domain">Domain (A-Z)</option>
              <option value="category">Category (A-Z)</option>
            </select>
            <div class="view-toggle" style="display: inline-flex; gap: 2px; background: #f0f0f0; border-radius: 6px; padding: 2px; margin: 0 8px;">
              <button class="view-toggle-btn active" data-view="grid" title="Grid View" style="padding: 6px 10px; background: white; border: none; border-radius: 4px; cursor: pointer; display: flex; align-items: center;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <rect x="3" y="3" width="7" height="7"></rect>
                  <rect x="14" y="3" width="7" height="7"></rect>
                  <rect x="14" y="14" width="7" height="7"></rect>
                  <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
              </button>
              <button class="view-toggle-btn" data-view="tree" title="Tree View" style="padding: 6px 10px; background: transparent; border: none; border-radius: 4px; cursor: pointer; display: flex; align-items: center;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M3 3v18M9 3v18M9 9h12M9 15h12"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Bulk Actions Toolbar -->
        <div class="bulk-toolbar" id="bulkToolbar" hidden>
          <div class="bulk-info">
            <span class="bulk-count">
              <span id="selectedCount">0</span> tabs selected
            </span>
            <button class="link-btn" id="selectAll">Select All</button>
            <button class="link-btn" id="clearSelection">Clear</button>
          </div>
          <div class="bulk-actions">
            <button class="bulk-action-btn" data-action="close">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
              Close
            </button>
            <button class="bulk-action-btn" data-action="snooze">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              Snooze
            </button>
            <button class="bulk-action-btn" data-action="group">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              </svg>
              Group
            </button>
            <button class="bulk-action-btn" data-action="move">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M21 11V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h6"></path>
                <path d="m12 12 4 10 1.7-4.3L22 16z"></path>
              </svg>
              Move
            </button>
          </div>
        </div>

        <!-- Tab Views Container -->
        <div class="tabs-container" id="tabsContainer">
          <!-- Grid View -->
          <div class="tabs-grid view-content active" id="tabsGrid" data-view="grid">
            <!-- Tab cards will be populated here -->
          </div>
          <!-- Tree View -->
          <div class="tabs-tree view-content" id="tabsTree" data-view="tree" style="display: none;">
            <!-- Tree structure will be populated here -->
          </div>
        </div>
      </div>

      <!-- Groups View -->
      <div class="view" id="groups">
        <div class="view-header">
          <h1>Tab Groups</h1>
          <div class="header-actions">
            <button class="btn btn-primary" id="ungroupAll">Ungroup All</button>
            <button class="btn btn-secondary" id="groupByDomain">Group by Domain</button>
          </div>
        </div>

        <div class="groups-container" id="groupsContainer">
          <!-- Groups will be populated here -->
        </div>
      </div>

      <!-- Snoozed View -->
      <div class="view" id="snoozed">
        <div class="view-header">
          <h1>Snoozed Tabs</h1>
          <div class="header-actions">
            <button class="btn btn-secondary" id="wakeAll">Wake All</button>
          </div>
        </div>

        <div class="snoozed-timeline" id="snoozedTimeline">
          <!-- Snoozed tabs timeline will be populated here -->
        </div>
      </div>

      <!-- History View -->
      <div class="view" id="history">
        <div class="view-header">
          <h1>Tab History</h1>
          <div class="header-actions">
            <input type="date" id="historyDate">
            <button class="btn btn-secondary" id="clearHistory">Clear History</button>
          </div>
        </div>

        <div class="history-container" id="historyContainer">
          <!-- History will be populated here -->
        </div>
      </div>

      <!-- Rules View -->
      <div class="view" id="rules">
        <div class="view-header">
          <h1>Rules Engine</h1>
          <div class="header-actions">
            <button class="btn btn-secondary" id="testAllRulesBtn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="16 12 12 8 12 16 16 12"></polyline>
              </svg>
              Run Rules Now
            </button>
            <button class="btn btn-danger" id="purgeAllRulesBtn" title="Delete all rules">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
              Purge All
            </button>
            <div class="dropdown">
              <button class="btn btn-primary dropdown-toggle" id="addRuleDropdown">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add Rule
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="margin-left: 4px;">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
              <div class="dropdown-menu" id="addRuleMenu">
                <button class="dropdown-item" id="addCustomRuleBtn">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                  </svg>
                  Create Custom Rule
                </button>
                <div class="dropdown-divider"></div>
                <div class="dropdown-header">Start from template:</div>
                <!-- Sample rule items will be added here dynamically -->
                <div id="sampleRuleItems"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="rules-container">
          <!-- Rules Header with quick actions -->
          <div class="rules-header">
            <div class="rules-info">
              <p class="rules-description">
                Create automated rules to manage your tabs. Rules execute in order from top to bottom. Drag to reorder.
              </p>
              <div class="rules-warning">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                  <line x1="12" y1="9" x2="12" y2="13"></line>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <span>Rules can automatically close or modify tabs. Test rules carefully before enabling them.</span>
              </div>
            </div>
            <div class="rules-quick-actions">
              <button class="btn btn-sm" id="disableAllRules">Disable All</button>
              <button class="btn btn-sm" id="enableAllRules">Enable All</button>
            </div>
          </div>

          <!-- Active Rules List -->
          <div class="rules-list" id="rulesList">
            <!-- Rules will be populated here -->
          </div>

          <!-- Empty state -->
          <div class="empty-state" id="rulesEmptyState" style="display: none;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <h3>No Rules Created</h3>
            <p>Create your first rule to automate tab management, or start from a template.</p>
            <button class="btn btn-primary" id="createFirstRuleBtn">Add Your First Rule</button>
          </div>
        </div>
      </div>

      <!-- Export/Import View -->
      <div class="view" id="export-import">
        <div class="view-header">
          <h1>Backup & Restore</h1>
        </div>

        <div class="view-content">
          <div class="export-import-container">
            <!-- Create Backup Section (Left Column) -->
            <div class="data-section">
              <h2>Create Backup</h2>
              <p class="section-description">Save your tabs, groups, rules, and settings.</p>

              <div class="export-options">
                <div class="option-group">
                  <h3>Scope</h3>
                  <div class="radio-group">
                    <label class="radio-option">
                      <input type="radio" name="exportScope" value="current-window" id="scopeCurrentWindow">
                      <span>Current Window (<span id="currentWindowTabCount">0</span> tabs)</span>
                    </label>
                    <label class="radio-option">
                      <input type="radio" name="exportScope" value="all-windows" id="scopeAllWindows" checked>
                      <span>All Windows (<span id="allWindowsTabCount">0</span> tabs)</span>
                    </label>
                  </div>
                </div>

                <div class="option-group">
                  <h3>Include</h3>
                  <div class="checkbox-group">
                    <label class="checkbox-option">
                      <input type="checkbox" id="includeGroups" checked>
                      <span>Tab Groups & Organization</span>
                    </label>
                    <label class="checkbox-option">
                      <input type="checkbox" id="includeRules" checked>
                      <span>Rules & Automation</span>
                    </label>
                    <label class="checkbox-option">
                      <input type="checkbox" id="includeSnoozed" checked>
                      <span>Snoozed Tabs</span>
                    </label>
                    <label class="checkbox-option">
                      <input type="checkbox" id="includeSettings" checked>
                      <span>Settings & Preferences</span>
                    </label>
                    <label class="checkbox-option">
                      <input type="checkbox" id="includeStatistics" checked>
                      <span>Usage Statistics</span>
                    </label>
                    <label class="checkbox-option">
                      <input type="checkbox" id="includeCollections" checked>
                      <span>Collections & Tasks</span>
                    </label>
                  </div>
                </div>

                <div class="option-group">
                  <h3>Format</h3>
                  <div class="radio-group">
                    <label class="radio-option">
                      <input type="radio" name="exportFormat" value="json" id="formatJSON" checked>
                      <span>Full Backup (.json)</span>
                      <small>Complete backup - can be restored</small>
                    </label>
                    <label class="radio-option">
                      <input type="radio" name="exportFormat" value="csv" id="formatCSV">
                      <span>Spreadsheet (.csv)</span>
                      <small>For Excel/Google Sheets analysis</small>
                    </label>
                    <label class="radio-option">
                      <input type="radio" name="exportFormat" value="markdown" id="formatMarkdown">
                      <span>Document (.md)</span>
                      <small>Human-readable list</small>
                    </label>
                  </div>
                </div>

                <button class="btn btn-primary btn-large" id="exportDataBtn">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  Backup Now
                </button>
              </div>
            </div>

            <!-- Right Column: Restore + Scheduled Backups -->
            <div class="right-column">
              <!-- Restore from Backup Section -->
              <div class="data-section">
              <h2>Restore from Backup</h2>
              <p class="section-description">Restore tabs, groups, rules, and settings from a previous backup.</p>

              <div class="import-options">
                <!-- File Drop Zone -->
                <div class="file-drop-zone" id="fileDropZone">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                  </svg>
                  <p>Drop file here or click to browse</p>
                  <p class="file-hint">Accepts .json files exported from TabTaskTick</p>
                  <input type="file" id="importFile" accept=".json" style="display: none;">
                </div>

                <!-- File Info (Hidden by default) -->
                <div class="file-info" id="fileInfo" style="display: none;">
                  <h3>File Information</h3>
                  <div class="info-grid">
                    <div class="info-item">
                      <span class="info-label">File:</span>
                      <span id="fileName">-</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">Size:</span>
                      <span id="fileSize">-</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">Format:</span>
                      <span id="fileFormat">-</span>
                    </div>
                  </div>
                </div>

                <!-- Import Preview (Hidden by default) -->
                <div class="import-preview" id="importPreview" style="display: none;">
                  <h3>Import Preview</h3>
                  <ul id="importSummaryList" class="summary-list">
                    <!-- Dynamically populated -->
                  </ul>
                </div>

                <!-- Import Options (Hidden by default) -->
                <div class="import-settings" id="importSettings" style="display: none;">
                  <div class="option-group">
                    <h3>Import To</h3>
                    <div class="radio-group">
                      <label class="radio-option">
                        <input type="radio" name="importScope" value="new-windows" id="importNewWindows" checked>
                        <span>New Window(s)</span>
                        <small>Safest - Creates new windows</small>
                      </label>
                      <label class="radio-option">
                        <input type="radio" name="importScope" value="current-window" id="importCurrentWindow">
                        <span>Current Window</span>
                        <small>Append to current window</small>
                      </label>
                      <label class="radio-option">
                        <input type="radio" name="importScope" value="replace-all" id="importReplaceAll">
                        <span>Replace All Windows</span>
                        <small>⚠️ Closes all existing windows</small>
                      </label>
                    </div>
                  </div>

                  <div class="option-group">
                    <h3>Options</h3>
                    <div class="checkbox-group">
                      <label class="checkbox-option">
                        <input type="checkbox" id="importGroups" checked>
                        <span>Import tab groups</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" id="importRules" checked>
                        <span>Import rules (merge)</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" id="importSnoozed" checked>
                        <span>Import snoozed tabs</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" id="importSettings">
                        <span>Import settings (override)</span>
                      </label>
                      <label class="checkbox-option">
                        <input type="checkbox" id="importCollections" checked>
                        <span>Import collections & tasks</span>
                      </label>
                    </div>
                  </div>

                  <div class="import-warning" id="importWarning" style="display: none;">
                    <!-- Dynamically populated -->
                  </div>

                  <div class="import-actions">
                    <button class="btn btn-secondary" id="cancelImport">Cancel</button>
                    <button class="btn btn-primary" id="confirmImport" disabled>
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                      </svg>
                      Restore Backup
                    </button>
                  </div>
                </div>
              </div>
            </div>

              <!-- Scheduled Backups Section -->
              <div class="data-section">
                <h2>Scheduled Backups</h2>
                <p class="section-description">Automatically create full backups on a schedule for disaster recovery.</p>

                <div class="backup-config">
                  <!-- Backup Settings -->
                  <div class="backup-settings">
                    <div class="setting-item">
                      <label class="switch">
                        <input type="checkbox" id="toggleBackups">
                        <span class="slider"></span>
                      </label>
                      <span>Enable automatic backups</span>
                      <span id="nextBackupTime" style="margin-left: auto; color: #666; font-size: 13px;">--</span>
                    </div>

                    <div class="setting-row">
                      <label for="backupFrequency">Frequency:</label>
                      <select id="backupFrequency">
                        <option value="hourly">Hourly</option>
                        <option value="daily" selected>Daily</option>
                        <option value="weekly">Weekly</option>
                      </select>
                      <label for="backupTime" style="margin-left: 16px;">Time:</label>
                      <input type="time" id="backupTime">
                    </div>

                    <!-- Backup History -->
                    <div class="backup-history-section">
                      <h3>Recent Backups</h3>
                      <div id="backupHistoryList" class="backup-history">
                        <div class="loading">Loading backup history...</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Collections View -->
      <div class="view" id="collections">
        <div class="view-header">
          <h1>Collections</h1>
          <div class="header-actions">
            <button class="btn btn-primary" id="saveCurrentWindow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
              </svg>
              Save Window
            </button>
          </div>
        </div>

        <div class="collections-container" id="collectionsContainer">
          <!-- Collections will be rendered here -->
        </div>
      </div>

      <!-- Tasks View -->
      <div class="view" id="tasks">
        <div class="view-header">
          <h1>Tasks</h1>
          <div class="header-actions">
            <div class="view-toggle" style="display: inline-flex; gap: 2px; background: #f0f0f0; border-radius: 6px; padding: 2px; margin-right: 8px;">
              <button class="view-toggle-btn active" data-view="kanban" title="Kanban View" id="tasksViewKanban">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <rect x="3" y="3" width="7" height="18"></rect>
                  <rect x="14" y="3" width="7" height="10"></rect>
                </svg>
                Kanban
              </button>
              <button class="view-toggle-btn" data-view="list" title="List View" id="tasksViewList">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <line x1="8" y1="6" x2="21" y2="6"></line>
                  <line x1="8" y1="12" x2="21" y2="12"></line>
                  <line x1="8" y1="18" x2="21" y2="18"></line>
                  <line x1="3" y1="6" x2="3.01" y2="6"></line>
                  <line x1="3" y1="12" x2="3.01" y2="12"></line>
                  <line x1="3" y1="18" x2="3.01" y2="18"></line>
                </svg>
                List
              </button>
            </div>
            <button class="btn btn-primary" id="createNewTask">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              New Task
            </button>
          </div>
        </div>

        <!-- Tasks Filter Bar -->
        <div class="tasks-filter-bar" id="tasksFilterBar">
          <div class="filter-row">
            <input type="text" class="search-input" id="searchTasks" placeholder="Search tasks...">
            <button class="btn btn-secondary btn-icon" id="toggleTasksFilters" title="Toggle Filters">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M3 6h18M7 12h10M11 18h2"></path>
              </svg>
              Filters
              <span class="filter-count-badge" id="tasksFilterCount" style="display: none;"></span>
            </button>
            <button class="btn btn-secondary btn-icon" id="clearTasksFilters" style="display: none;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
              Clear
            </button>
          </div>
          <div class="filter-panel" id="tasksFilterPanel" style="display: none;">
            <div class="filter-group">
              <label class="filter-label">Status</label>
              <div class="filter-checkboxes">
                <label class="filter-checkbox-label">
                  <input type="checkbox" class="filter-checkbox" data-filter="status" value="open">
                  <span>Open</span>
                </label>
                <label class="filter-checkbox-label">
                  <input type="checkbox" class="filter-checkbox" data-filter="status" value="active">
                  <span>Active</span>
                </label>
                <label class="filter-checkbox-label">
                  <input type="checkbox" class="filter-checkbox" data-filter="status" value="fixed">
                  <span>Fixed</span>
                </label>
                <label class="filter-checkbox-label">
                  <input type="checkbox" class="filter-checkbox" data-filter="status" value="abandoned">
                  <span>Abandoned</span>
                </label>
              </div>
            </div>
            <div class="filter-group">
              <label class="filter-label">Priority</label>
              <div class="filter-checkboxes">
                <label class="filter-checkbox-label">
                  <input type="checkbox" class="filter-checkbox" data-filter="priority" value="low">
                  <span>Low</span>
                </label>
                <label class="filter-checkbox-label">
                  <input type="checkbox" class="filter-checkbox" data-filter="priority" value="medium">
                  <span>Medium</span>
                </label>
                <label class="filter-checkbox-label">
                  <input type="checkbox" class="filter-checkbox" data-filter="priority" value="high">
                  <span>High</span>
                </label>
                <label class="filter-checkbox-label">
                  <input type="checkbox" class="filter-checkbox" data-filter="priority" value="critical">
                  <span>Critical</span>
                </label>
              </div>
            </div>
            <div class="filter-group">
              <label class="filter-label">Collection</label>
              <select class="filter-select" id="tasksCollectionFilter" multiple size="6">
                <option value="">Uncategorized</option>
                <!-- Collection options will be populated dynamically -->
              </select>
            </div>
          </div>
        </div>

        <!-- Bulk Actions Bar -->
        <div class="bulk-toolbar" id="tasksBulkBar" style="display: none;">
          <div class="bulk-info">
            <span class="bulk-count">0 tasks selected</span>
            <button class="link-btn" id="tasksSelectAll">Select All</button>
            <button class="link-btn" id="tasksClearSelection">Clear</button>
          </div>
          <div class="bulk-actions">
            <button class="bulk-action-btn" data-action="changeStatus">Change Status</button>
            <button class="bulk-action-btn" data-action="changePriority">Change Priority</button>
            <button class="bulk-action-btn" data-action="delete">Delete Selected</button>
          </div>
        </div>

        <!-- Kanban Container -->
        <div class="tasks-view-container active" id="tasksKanbanContainer" data-view="kanban">
          <!-- Kanban board will be rendered here -->
        </div>

        <!-- List Container -->
        <div class="tasks-view-container" id="tasksListContainer" data-view="list" style="display: none;">
          <!-- List view will be rendered here -->
        </div>
      </div>
    </main>
  </div>

  <!-- Modals -->
  <!-- Confirmation Modal -->
  <div class="modal" id="confirmModal">
    <div class="modal-content compact">
      <h3 id="confirmTitle">Confirm Action</h3>
      <p id="confirmMessage"></p>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="confirmCancel">Cancel</button>
        <button class="btn btn-danger" id="confirmProceed">Proceed</button>
      </div>
    </div>
  </div>

  <!-- Progress Overlay -->
  <div class="progress-overlay" id="progressOverlay" style="display: none;">
    <div class="progress-content">
      <div class="spinner"></div>
      <div class="progress-text" id="progressText">Processing...</div>
    </div>
  </div>

  <!-- Quick Organize Modal -->
  <div class="modal" id="quickOrganizeModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Quick Organize</h3>
        <button class="close-btn" id="closeQuickOrganize">&times;</button>
      </div>
      <div class="modal-body">
        <div class="organize-options">
          <label class="organize-option">
            <input type="checkbox" id="orgCloseDupes" checked>
            <span>Close duplicate tabs</span>
            <span class="option-count" id="dupeCount">(0 found)</span>
          </label>
          <label class="organize-option">
            <input type="checkbox" id="orgGroupDomains" checked>
            <span>Group tabs by domain</span>
            <span class="option-count" id="domainGroupCount">(0 groups)</span>
          </label>
          <label class="organize-option">
            <input type="checkbox" id="orgSnoozeInactive" checked>
            <span>Snooze inactive tabs</span>
            <span class="option-count" id="inactiveCount">(0 tabs)</span>
          </label>
          <label class="organize-option">
            <input type="checkbox" id="orgSuspendHeavy">
            <span>Suspend memory-heavy tabs</span>
            <span class="option-count" id="heavyCount">(0 tabs)</span>
          </label>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelOrganize">Cancel</button>
          <button class="btn btn-primary" id="executeOrganize">Organize Now</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Rule Editor Modal -->
  <div class="modal" id="ruleModal">
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h3 id="ruleModalTitle">Add New Rule</h3>
        <button class="close-btn" id="closeRuleModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="ruleName">Rule Name</label>
          <input type="text" id="ruleName" placeholder="Enter a descriptive name for this rule">
        </div>

        <div class="form-group">
          <label>Conditions</label>
          <div id="conditionsContainer">
            <!-- Conditions builder will be initialized here -->
          </div>
          <div class="condition-preview">
            <h4>Preview</h4>
            <div class="preview-text" id="conditionPreview">
              Match ALL tabs where URL contains "example.com"
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Actions (in order)</label>
          <div id="actionsContainer" class="actions-list">
            <!-- Actions will be listed here -->
          </div>
          <button class="btn btn-secondary" id="addActionBtn">+ Add Action</button>
        </div>

        <div class="form-group trigger-type" id="triggerSection">
          <label for="triggerType">When to apply</label>
          <select id="triggerType">
            <option value="immediate">On tab events (immediate)</option>
            <option value="repeat">Repeat periodically</option>
            <option value="once">Once at specific time</option>
            <option value="manual">Manual only</option>
          </select>
          <div id="triggerParams" class="trigger-params">
            <!-- Dynamic trigger parameters -->
          </div>
        </div>

        <div class="form-group">
          <label for="ruleEnabled">
            <input type="checkbox" id="ruleEnabled" checked>
            Enable rule immediately
          </label>
          <p class="help-text">You can test the rule before enabling it</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelRuleBtn">Cancel</button>
        <button class="btn btn-primary" id="saveRuleBtn">Save Rule</button>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal" id="confirmModal">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h3 id="confirmTitle">Confirm Action</h3>
      </div>
      <div class="modal-body">
        <p id="confirmMessage">Are you sure you want to proceed?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="confirmCancel">Cancel</button>
        <button class="btn btn-primary" id="confirmProceed">Proceed</button>
      </div>
    </div>
  </div>

  <script src="../lib/chart.min.js"></script>
  <script src="../components/snooze-modal.js"></script>
  <script src="export-import.js"></script>
  <script type="module" src="dashboard.js"></script>
</body>
</html>
